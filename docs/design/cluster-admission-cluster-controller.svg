<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="806px" preserveAspectRatio="none" style="width:460px;height:806px;" version="1.1" viewBox="0 0 460 806" width="460px" zoomAndPan="magnify"><defs><filter height="300%" id="fglt10t4frrd0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="221.5" cy="20" fill="#000000" filter="url(#fglt10t4frrd0)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fglt10t4frrd0)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="162.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="98" x="172.5" y="71.6016">Cluster controller</text><rect fill="#FEFECE" filter="url(#fglt10t4frrd0)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="270" x="86.5" y="148.1328"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="250" x="96.5" y="169.7344">Cluster controller enqueues a Reconcile call</text><rect fill="#ADD8E6" filter="url(#fglt10t4frrd0)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="239" x="102" y="250.7432"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="219" x="112" y="272.3447">Get control plane machines for cluster</text><polygon fill="#FEFECE" filter="url(#fglt10t4frrd0)" points="134,304.876,309,304.876,321,316.876,309,328.876,134,328.876,122,316.876,134,304.876" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="175" x="134" y="321.0332">A control plane machine is ready</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="18" x="104" y="314.5557">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="321" y="314.5557">no</text><rect fill="#ADD8E6" filter="url(#fglt10t4frrd0)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="185" x="19.5" y="338.876"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="165" x="29.5" y="360.4775">Set Cluster Ready annotation</text><rect fill="#ADD8E6" filter="url(#fglt10t4frrd0)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="135" x="44.5" y="408.0088"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="115" x="54.5" y="429.6104">Patch Cluster object</text><rect fill="#ADD8E6" filter="url(#fglt10t4frrd0)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="204" x="10" y="462.1416"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="184" x="20" y="483.7432">Delete control plane config map</text><rect fill="#FFC0CB" filter="url(#fglt10t4frrd0)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="260" y="338.876"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="122" x="270" y="360.4775">Return RequeueError</text><polygon fill="#FEFECE" filter="url(#fglt10t4frrd0)" points="221.5,502.2744,233.5,514.2744,221.5,526.2744,209.5,514.2744,221.5,502.2744" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#fglt10t4frrd0)" points="144,202.2656,299,202.2656,311,214.2656,299,226.2656,144,226.2656,132,214.2656,144,202.2656" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="225.5" y="236.9004">no</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="155" x="144" y="218.4229">Cluster has ready annotation</text><polygon fill="#FEFECE" filter="url(#fglt10t4frrd0)" points="221.5,546.2744,233.5,558.2744,221.5,570.2744,209.5,558.2744,221.5,546.2744" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#fglt10t4frrd0)" points="221.5,104.1328,233.5,116.1328,221.5,128.1328,209.5,116.1328,221.5,104.1328" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#fglt10t4frrd0)" points="132.5,590.2744,310.5,590.2744,322.5,602.2744,310.5,614.2744,132.5,614.2744,120.5,602.2744,132.5,590.2744" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="178" x="132.5" y="606.4316">Reconcile returned RequeueError</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="18" x="322.5" y="599.9541">yes</text><polygon fill="#FEFECE" filter="url(#fglt10t4frrd0)" points="155.5,655.5498,287.5,655.5498,299.5,667.5498,287.5,679.5498,155.5,679.5498,143.5,667.5498,155.5,655.5498" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="132" x="155.5" y="671.707">Reconcile returned error</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="18" x="125.5" y="665.2295">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="299.5" y="665.2295">no</text><rect fill="#FFC0CB" filter="url(#fglt10t4frrd0)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="55.5" y="689.5498"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="136" x="65.5" y="711.1514">Error reconciling cluster</text><rect fill="#ADD8E6" filter="url(#fglt10t4frrd0)" height="34.1328" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="254.5" y="689.5498"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="90" x="264.5" y="711.1514">Cluster is ready</text><polygon fill="#FEFECE" filter="url(#fglt10t4frrd0)" points="221.5,729.6826,233.5,741.6826,221.5,753.6826,209.5,741.6826,221.5,729.6826" style="stroke: #A80036; stroke-width: 1.5;"/><ellipse cx="221.5" cy="784.6826" fill="#FFFFFF" filter="url(#fglt10t4frrd0)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="221.5" cy="784.6826" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="221.5" x2="221.5" y1="30" y2="50"/><polygon fill="#A80036" points="217.5,40,221.5,50,225.5,40,221.5,44" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="112" x2="112" y1="373.0088" y2="408.0088"/><polygon fill="#A80036" points="108,398.0088,112,408.0088,116,398.0088,112,402.0088" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="112" x2="112" y1="442.1416" y2="462.1416"/><polygon fill="#A80036" points="108,452.1416,112,462.1416,116,452.1416,112,456.1416" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="122" x2="112" y1="316.876" y2="316.876"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="112" x2="112" y1="316.876" y2="338.876"/><polygon fill="#A80036" points="108,328.876,112,338.876,116,328.876,112,332.876" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="321" x2="331" y1="316.876" y2="316.876"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="331" x2="331" y1="316.876" y2="338.876"/><polygon fill="#A80036" points="327,328.876,331,338.876,335,328.876,331,332.876" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="112" x2="112" y1="496.2744" y2="514.2744"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="112" x2="209.5" y1="514.2744" y2="514.2744"/><polygon fill="#A80036" points="199.5,510.2744,209.5,514.2744,199.5,518.2744,203.5,514.2744" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="331" x2="331" y1="373.0088" y2="514.2744"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="331" x2="233.5" y1="514.2744" y2="514.2744"/><polygon fill="#A80036" points="243.5,510.2744,233.5,514.2744,243.5,518.2744,239.5,514.2744" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="221.5" x2="221.5" y1="284.876" y2="304.876"/><polygon fill="#A80036" points="217.5,294.876,221.5,304.876,225.5,294.876,221.5,298.876" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="221.5" x2="221.5" y1="226.2656" y2="250.7432"/><polygon fill="#A80036" points="217.5,240.7432,221.5,250.7432,225.5,240.7432,221.5,244.7432" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="311" x2="416" y1="214.2656" y2="214.2656"/><polygon fill="#A80036" points="412,378.5088,416,388.5088,420,378.5088,416,382.5088" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="416" x2="416" y1="214.2656" y2="558.2744"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="416" x2="233.5" y1="558.2744" y2="558.2744"/><polygon fill="#A80036" points="243.5,554.2744,233.5,558.2744,243.5,562.2744,239.5,558.2744" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="221.5" x2="221.5" y1="526.2744" y2="546.2744"/><polygon fill="#A80036" points="217.5,536.2744,221.5,546.2744,225.5,536.2744,221.5,540.2744" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="221.5" x2="221.5" y1="182.2656" y2="202.2656"/><polygon fill="#A80036" points="217.5,192.2656,221.5,202.2656,225.5,192.2656,221.5,196.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="221.5" x2="221.5" y1="128.1328" y2="148.1328"/><polygon fill="#A80036" points="217.5,138.1328,221.5,148.1328,225.5,138.1328,221.5,142.1328" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="322.5" x2="434" y1="602.2744" y2="602.2744"/><polygon fill="#A80036" points="430,363.9424,434,353.9424,438,363.9424,434,359.9424" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="434" x2="434" y1="116.1328" y2="602.2744"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="434" x2="233.5" y1="116.1328" y2="116.1328"/><polygon fill="#A80036" points="243.5,112.1328,233.5,116.1328,243.5,120.1328,239.5,116.1328" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="221.5" x2="221.5" y1="570.2744" y2="590.2744"/><polygon fill="#A80036" points="217.5,580.2744,221.5,590.2744,225.5,580.2744,221.5,584.2744" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="221.5" x2="221.5" y1="84.1328" y2="104.1328"/><polygon fill="#A80036" points="217.5,94.1328,221.5,104.1328,225.5,94.1328,221.5,98.1328" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="143.5" x2="133.5" y1="667.5498" y2="667.5498"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="133.5" x2="133.5" y1="667.5498" y2="689.5498"/><polygon fill="#A80036" points="129.5,679.5498,133.5,689.5498,137.5,679.5498,133.5,683.5498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="299.5" x2="309.5" y1="667.5498" y2="667.5498"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="309.5" x2="309.5" y1="667.5498" y2="689.5498"/><polygon fill="#A80036" points="305.5,679.5498,309.5,689.5498,313.5,679.5498,309.5,683.5498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="133.5" x2="133.5" y1="723.6826" y2="741.6826"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="133.5" x2="209.5" y1="741.6826" y2="741.6826"/><polygon fill="#A80036" points="199.5,737.6826,209.5,741.6826,199.5,745.6826,203.5,741.6826" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="309.5" x2="309.5" y1="723.6826" y2="741.6826"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="309.5" x2="233.5" y1="741.6826" y2="741.6826"/><polygon fill="#A80036" points="243.5,737.6826,233.5,741.6826,243.5,745.6826,239.5,741.6826" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="221.5" x2="221.5" y1="614.2744" y2="655.5498"/><polygon fill="#A80036" points="217.5,645.5498,221.5,655.5498,225.5,645.5498,221.5,649.5498" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="225.5" y="635.7295">no</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="221.5" x2="221.5" y1="753.6826" y2="773.6826"/><polygon fill="#A80036" points="217.5,763.6826,221.5,773.6826,225.5,763.6826,221.5,767.6826" style="stroke: #A80036; stroke-width: 1.0;"/><!--
@startuml cluster-admission-cluster-controller

start;
:Cluster controller;

repeat
  :Cluster controller enqueues a Reconcile call;
  if (Cluster has ready annotation) then (no)
    #LightBlue:Get control plane machines for cluster;
    if (A control plane machine is ready) then (yes)
      #LightBlue:Set Cluster Ready annotation;
      #LightBlue:Patch Cluster object;
      #LightBlue:Delete control plane config map;
    else (no)
      #Pink:Return RequeueError;
    endif
  endif
repeat while (Reconcile returned RequeueError) is (yes)
-> no;
if (Reconcile returned error) then (yes)
  #Pink:Error reconciling cluster;
else (no)
  #LightBlue:Cluster is ready;
endif
stop;

@enduml

PlantUML version 1.2019.06(Fri May 24 12:10:25 CDT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_191-b12
Operating System: Mac OS X
OS Version: 10.14.5
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>